// ========================================
// CONFIGURATION FIREBASE
// ========================================
// IMPORTANT : Remplacez par votre propre configuration !
const firebaseConfig = {
    apiKey: "AIzaSyD-rOIEpoV68RJ-Z2Sd2qwCWSBlUZtLzxs",
    authDomain: "blog-tutoriel-azur.firebaseapp.com",
    projectId: "blog-tutoriel-azur",
    storageBucket: "blog-tutoriel-azur.firebasestorage.app",
    messagingSenderId: "526070824601",
    appId: "1:526070824601:web:98c98e9369fe95ea1a4208"
};

// Initialisation de Firebase
firebase.initializeApp(firebaseConfig);
const auth = firebase.auth();
const db = firebase.firestore();

// ========================================
// VARIABLES GLOBALES
// ========================================
let currentUser = null;          // Utilisateur connectÃ©
let currentEditingArticle = null; // Article en cours d'Ã©dition
let isAdmin = false;             // Statut admin
let isLoadingArticles = false;   // Flag de chargement



// ========================================
// OBSERVER D'AUTHENTIFICATION
// ========================================
auth.onAuthStateChanged(async (user) => {
    currentUser = user;
    
    if (user) {
        console.log('âœ… Utilisateur connectÃ©:', user.email);
        
        // RÃ©cupÃ©rer les informations utilisateur
        try {
            const userDoc = await db.collection('users').doc(user.uid).get();
            
            if (userDoc.exists) {
                const userData = userDoc.data();
                isAdmin = userData.role === 'admin';
                document.getElementById('userInfo').textContent = 
                    `Bonjour, ${userData.displayName || user.email}`;
            } else {
                // CrÃ©er le profil si inexistant
                await db.collection('users').doc(user.uid).set({
                    email: user.email,
                    displayName: user.displayName || user.email.split('@')[0],
                    role: 'user',
                    createdAt: firebase.firestore.FieldValue.serverTimestamp()
                });
            }
        } catch (error) {
            console.error('Erreur lors de la rÃ©cupÃ©ration du profil:', error);
        }

        // Mise Ã  jour de l'interface
        document.getElementById('loginBtn').style.display = 'none';
        document.getElementById('registerBtn').style.display = 'none';
        document.getElementById('logoutBtn').style.display = 'block';
        
        if (isAdmin) {
            document.getElementById('adminPanel').style.display = 'block';
        }
    } else {
        console.log('ðŸ‘¤ Utilisateur dÃ©connectÃ©');
        
        // RÃ©initialisation
        document.getElementById('userInfo').textContent = '';
        document.getElementById('loginBtn').style.display = 'block';
        document.getElementById('registerBtn').style.display = 'block';
        document.getElementById('logoutBtn').style.display = 'none';
        document.getElementById('adminPanel').style.display = 'none';
        isAdmin = false;
    }
    
    // Recharger les articles
    loadArticles();
});

// ========================================
// EVENT LISTENERS
// ========================================
document.addEventListener('DOMContentLoaded', () => {
    // Boutons d'authentification
    document.getElementById('loginBtn').addEventListener('click', 
        () => openModal('loginModal'));
    
    document.getElementById('registerBtn').addEventListener('click', 
        () => openModal('registerModal'));
    
    document.getElementById('logoutBtn').addEventListener('click', logout);
    
    // Bouton nouvel article (admin)
    const newArticleBtn = document.getElementById('newArticleBtn');
    if (newArticleBtn) {
        newArticleBtn.addEventListener('click', () => {
            currentEditingArticle = null;
            document.getElementById('articleModalTitle').textContent = 'Nouvel Article';
            document.getElementById('articleForm').reset();
            openModal('articleModal');
        });
    }
    
    // Formulaires
    document.getElementById('loginForm').addEventListener('submit', handleLogin);
    document.getElementById('registerForm').addEventListener('submit', handleRegister);
    document.getElementById('articleForm').addEventListener('submit', handleArticleSubmit);
});


